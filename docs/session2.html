<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Introduction to R for text analysis</title>

<script src="site_libs/header-attrs-2.9/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>
<script src="site_libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="site_libs/wordcloud2-0.0.1/wordcloud.css" rel="stylesheet" />
<script src="site_libs/wordcloud2-0.0.1/wordcloud2-all.js"></script>
<script src="site_libs/wordcloud2-0.0.1/hover.js"></script>
<script src="site_libs/wordcloud2-binding-0.2.1/wordcloud2.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Computational Text Analysis for Digital Humanities</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="schedule.html">Schedule</a>
</li>
<li>
  <a href="session1.html">Overview of methods</a>
</li>
<li>
  <a href="session2.html">Introduction to R for text analysis</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Introduction to R for text analysis</h1>

</div>


<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<div id="data-types-in-r-very-briefly" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Data types in R (very briefly)</h1>
<p>R has officially six different data types, of which four of them we will be concerned with: character, numeric, integer, and logical. We can quickly tell what kind of data type we are working with by using typeof() or mode() functions (they’re slightly different but from our standpoint they will be same.)</p>
<pre class="r"><code>typeof(&#39;hello&#39;) # character</code></pre>
<pre><code>## [1] &quot;character&quot;</code></pre>
<pre class="r"><code>typeof(52L) # the &#39;L&#39; tells R to store it as an integer</code></pre>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<pre class="r"><code>typeof(2.542) #double, ie numeric</code></pre>
<pre><code>## [1] &quot;double&quot;</code></pre>
<pre class="r"><code>typeof(FALSE) #logical</code></pre>
<pre><code>## [1] &quot;logical&quot;</code></pre>
<pre class="r"><code># if we make an assignment typeof() will tell us the data type of the underlying value
x &lt;- 2.52; typeof(x)</code></pre>
<pre><code>## [1] &quot;double&quot;</code></pre>
<pre class="r"><code>y &lt;- &quot;Hello&quot;; typeof(y)</code></pre>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>If we try to do operations on data types that don’t make any sense, R will let us know.</p>
<pre class="r"><code>x + y</code></pre>
<pre><code>## Error in x + y: non-numeric argument to binary operator</code></pre>
<p>Obviously, if we ask R to tell us what 2.52 + “Hello” is, it’s going to be hard to give a reasonable answer. (Notice the somewhat cryptic error message, we’re going to have to get used to that, though some of the packages we’ll be using are really making an effort to be more helpful.) In this case it’s obvious, but as you do more and more complicated things in R with larger and larger amounts of data it will not always be the case. This is a frequent source of bugs and something to be aware of from the beginning.</p>
<p>Data structures are ways and forms of combining data. The simplest way of doing this is with a “vector” essentially a list (but lists are different as we’ll soon see). You’ve already seen how to create vectors:</p>
<pre class="r"><code>c(&quot;Hello&quot;, &quot;how&quot;, &quot;are&quot;, &quot;you&quot;, &quot;?&quot;)</code></pre>
<pre><code>## [1] &quot;Hello&quot; &quot;how&quot;   &quot;are&quot;   &quot;you&quot;   &quot;?&quot;</code></pre>
<p>Other data structures we will work with are matrices (essentially two dimensional vectors, corpora, term frequency matrices and so on, but especially dataframes. These structures have different rules and frequently they are picky about what sort of operations they allow you to do with them, even if they look similar. Vectors and matrices, for instance can only hold one type of data.</p>
<pre class="r"><code>(c &lt;- c(5, &quot;hello!&quot;)) # Notice what happens here - the 5 is &quot;coerced&quot; into becoming a character. </code></pre>
<pre><code>## [1] &quot;5&quot;      &quot;hello!&quot;</code></pre>
<pre class="r"><code>c[1] + 1 # Thus you can&#39;t do arithmetic anymore on the 5 -- 5+1=6 but &quot;5&quot;+1 is the same kind of operation as 2 + &quot;Hello&quot;.</code></pre>
<pre><code>## Error in c[1] + 1: non-numeric argument to binary operator</code></pre>
<p>But you can do this with the data structure lists, which otherwise look quite similar to vectors.</p>
<pre class="r"><code>(l &lt;- list(5, &quot;hello!&quot;)) # this does not coerce the 5 to become a charcter</code></pre>
<pre><code>## [[1]]
## [1] 5
## 
## [[2]]
## [1] &quot;hello!&quot;</code></pre>
<pre class="r"><code>l[[1]] + 1 # and this now works because the 5 is still a number. Notice contents of lists are subset by double [[]]</code></pre>
<pre><code>## [1] 6</code></pre>
<p>You can put all kinds of things together in lists and name them</p>
<pre class="r"><code>ll &lt;- list(name = &quot;Bob&quot;, age = 50, ingarage = head(mtcars))
names(ll)</code></pre>
<pre><code>## [1] &quot;name&quot;     &quot;age&quot;      &quot;ingarage&quot;</code></pre>
<p>Two-dimensional vectors are matrices (must have all same data type) and 2D lists are dataframes. To find what data structure we are dealing with, we type class()</p>
<pre class="r"><code>class(ll)</code></pre>
<pre><code>## [1] &quot;list&quot;</code></pre>
<pre class="r"><code>str(ll)</code></pre>
<pre><code>## List of 3
##  $ name    : chr &quot;Bob&quot;
##  $ age     : num 50
##  $ ingarage:&#39;data.frame&#39;:    6 obs. of  11 variables:
##   ..$ mpg : num [1:6] 21 21 22.8 21.4 18.7 18.1
##   ..$ cyl : num [1:6] 6 6 4 6 8 6
##   ..$ disp: num [1:6] 160 160 108 258 360 225
##   ..$ hp  : num [1:6] 110 110 93 110 175 105
##   ..$ drat: num [1:6] 3.9 3.9 3.85 3.08 3.15 2.76
##   ..$ wt  : num [1:6] 2.62 2.88 2.32 3.21 3.44 ...
##   ..$ qsec: num [1:6] 16.5 17 18.6 19.4 17 ...
##   ..$ vs  : num [1:6] 0 0 1 1 0 1
##   ..$ am  : num [1:6] 1 1 1 0 0 0
##   ..$ gear: num [1:6] 4 4 4 3 3 3
##   ..$ carb: num [1:6] 4 4 1 1 2 1</code></pre>
<p>The str() command is also quite helpful, showing data structure, data types, names, and dimensions (which can also be found via length()). The main point to be remembered is that trying to do things with the wrong type of structure of data is a very common sources of problems. Especially as we get into more advanced text analysis packages we’ll always want to keep in mind what the structures and types of data we’re dealing with are.</p>
</div>
<div id="beginning-to-work-with-text" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Beginning to work with text</h1>
<p>There are numerous ways text can be stored in R but the most basic way, and one we will be working with today, is as a list of characters, called a “character vector” or “string”.</p>
<p>For an example, lets take the first several paragraphs of the lead story on nrk.no (<a href="https://www.nrk.no/norge/regjeringen-foreslar-endringer-i-statsbudsjettet-1.15721082" class="uri">https://www.nrk.no/norge/regjeringen-foreslar-endringer-i-statsbudsjettet-1.15721082</a>) when this tutorial was being compiled.</p>
<pre class="r"><code>nrk &lt;- c(&quot;Kl 12 legger finansminister Trygve Slagsvold Vedum (Sp) fram regjeringens forslag til endringer i statsbudsjettet for neste år. Regjeringen har hatt rundt tre uker på seg til å gjøre endringer i budsjettet.&quot;, &quot;Øker formuesskatten&quot;, &quot;Regjeringen foreslår å øke formuesskatten fra dagens sats på 0,85 prosent til 0,95 prosent av netto formue. Samtidig økes bunnfradraget fra 1,5 til 1,65 millioner kroner, det dobbelte for ektepar.&quot;, &quot;Formuesrabatten for aksjer og driftsmidler kuttes fra 45 prosent i 2021 til 35 prosent neste år. Det betyr at den skattemessige verdien av aksjer vil settes nærmere aksjene faktiske verdi.&quot;, &quot;Formuesrabatten for aksjer og driftsmidler kuttes fra 45 prosent i 2021 til 35 prosent neste år. Det betyr at den skattemessige verdien av aksjer vil settes nærmere aksjene faktiske verdi.&quot;, &quot;Regjeringen foreslår også å øke likningsverdien på fritidsboliger med 25 prosent. Dette får også betydning for formuesskatten.&quot;, &quot;Totalt vil dette gi 3,66 milliarder kroner ekstra i statskassa. Øker drivstoffprisene mindre enn Solberg-regjeringen&quot;, &quot;Et av de store klima-grepene til den utgående regjeringen Solberg var å øke CO₂-avgiften med 28 prosent utover forventet prisstigning.&quot;, &quot;Det ville i så fall bety at CO₂-avgiften på bensin ville øke med 41 øre per liter.&quot;)

nrk</code></pre>
<pre><code>## [1] &quot;Kl 12 legger finansminister Trygve Slagsvold Vedum (Sp) fram regjeringens forslag til endringer i statsbudsjettet for neste år. Regjeringen har hatt rundt tre uker på seg til å gjøre endringer i budsjettet.&quot;
## [2] &quot;Øker formuesskatten&quot;                                                                                                                                                                                           
## [3] &quot;Regjeringen foreslår å øke formuesskatten fra dagens sats på 0,85 prosent til 0,95 prosent av netto formue. Samtidig økes bunnfradraget fra 1,5 til 1,65 millioner kroner, det dobbelte for ektepar.&quot;          
## [4] &quot;Formuesrabatten for aksjer og driftsmidler kuttes fra 45 prosent i 2021 til 35 prosent neste år. Det betyr at den skattemessige verdien av aksjer vil settes nærmere aksjene faktiske verdi.&quot;                  
## [5] &quot;Formuesrabatten for aksjer og driftsmidler kuttes fra 45 prosent i 2021 til 35 prosent neste år. Det betyr at den skattemessige verdien av aksjer vil settes nærmere aksjene faktiske verdi.&quot;                  
## [6] &quot;Regjeringen foreslår også å øke likningsverdien på fritidsboliger med 25 prosent. Dette får også betydning for formuesskatten.&quot;                                                                                
## [7] &quot;Totalt vil dette gi 3,66 milliarder kroner ekstra i statskassa. Øker drivstoffprisene mindre enn Solberg-regjeringen&quot;                                                                                          
## [8] &quot;Et av de store klima-grepene til den utgående regjeringen Solberg var å øke CO2-avgiften med 28 prosent utover forventet prisstigning.&quot;                                                                        
## [9] &quot;Det ville i så fall bety at CO2-avgiften på bensin ville øke med 41 øre per liter.&quot;</code></pre>
<p>I have broken up the first several paragraphs into individual character strings and saved it as a variable called <code>nrk</code>, thus when we “call” the variable (i.e. ask R to evaluate the variable and tell us what the result is), it prints out in four parts the text we assigned to the variable. We’ll use this short, simple example to get the basics down for working with text data and producing basic word frequency counts and word clouds, then see how we do this with larger texts that we can easily download via R.</p>
<p>We are going to be working with a group of R packages called the tidyverse that have been extensively developed over the last years and are exceptionally user-friendly and well-designed and documented. The tidyverse version of the dataframe is called a tibble, so we’ll convert our four lines of text to a tibble. Note we have to load the library first.</p>
<pre class="r"><code>library(tidyverse)
nrk &lt;- tibble(paragraph = 1:length(nrk), text = nrk)
nrk</code></pre>
<pre><code>## # A tibble: 9 x 2
##   paragraph text                                                                                                                                     
##       &lt;int&gt; &lt;chr&gt;                                                                                                                                    
## 1         1 Kl 12 legger finansminister Trygve Slagsvold Vedum (Sp) fram regjeringens forslag til endringer i statsbudsjettet for neste år. Regjerin~
## 2         2 Øker formuesskatten                                                                                                                      
## 3         3 Regjeringen foreslår å øke formuesskatten fra dagens sats på 0,85 prosent til 0,95 prosent av netto formue. Samtidig økes bunnfradraget ~
## 4         4 Formuesrabatten for aksjer og driftsmidler kuttes fra 45 prosent i 2021 til 35 prosent neste år. Det betyr at den skattemessige verdien ~
## 5         5 Formuesrabatten for aksjer og driftsmidler kuttes fra 45 prosent i 2021 til 35 prosent neste år. Det betyr at den skattemessige verdien ~
## 6         6 Regjeringen foreslår også å øke likningsverdien på fritidsboliger med 25 prosent. Dette får også betydning for formuesskatten.           
## 7         7 Totalt vil dette gi 3,66 milliarder kroner ekstra i statskassa. Øker drivstoffprisene mindre enn Solberg-regjeringen                     
## 8         8 Et av de store klima-grepene til den utgående regjeringen Solberg var å øke CO2-avgiften med 28 prosent utover forventet prisstigning.   
## 9         9 Det ville i så fall bety at CO2-avgiften på bensin ville øke med 41 øre per liter.</code></pre>
<p>One of the first things that one will often, but not always, want to do with a text when computationally analyzing it is break it into its individual words, where each individual instance of a word is called a token. This is called “tokenizing” the text. Using the tidyverse and tidy’s philosophy of data formatting (a well-developed philosophy, see <a href="https://tidyr.tidyverse.org/articles/tidy-data.html" class="uri">https://tidyr.tidyverse.org/articles/tidy-data.html</a>) we will tokenize the text and make each token a row in the dataframe. We do this by using the <code>unnest_tokens()</code> command (part of the tidytext library, thus we’ll need to load this library as well) and “passing” (inputing into the function) the name we’d like to use for the column of words – let’s be boring and use the word “word” – of the column of words it creates, and the text that it will be tokenizing and turning into columns.</p>
<pre class="r"><code>library(tidytext)
nrk %&gt;%
  unnest_tokens(token, text)</code></pre>
<pre><code>## # A tibble: 197 x 2
##    paragraph token         
##        &lt;int&gt; &lt;chr&gt;         
##  1         1 kl            
##  2         1 12            
##  3         1 legger        
##  4         1 finansminister
##  5         1 trygve        
##  6         1 slagsvold     
##  7         1 vedum         
##  8         1 sp            
##  9         1 fram          
## 10         1 regjeringens  
## # ... with 187 more rows</code></pre>
<p>Here we used a <code>%&gt;%</code> sign which is called a “pipe”. Essentially what this says is to take what comes before the pipe (the variable <code>nrk</code>) and use it as the first argument (the first input into) the following function. So it’s the same as typing <code>unnest_tokens(nrk, token, text)</code>. As we’ll see shortly these pipes can be piled upon one another and save typing.</p>
<p>Notice too that `unnest_tokens()`` also does some other work for us – it turns all letters into lower case and removes punctuation.</p>
<p>This is actually all we need to create a word frequency list.</p>
<pre class="r"><code>nrk %&gt;%
  unnest_tokens(token, text) %&gt;%
  count(token, sort = TRUE)</code></pre>
<pre><code>## # A tibble: 111 x 2
##    token           n
##    &lt;chr&gt;       &lt;int&gt;
##  1 prosent         8
##  2 til             7
##  3 i               6
##  4 for             5
##  5 regjeringen     5
##  6 aksjer          4
##  7 av              4
##  8 det             4
##  9 fra             4
## 10 på              4
## # ... with 101 more rows</code></pre>
<p>We notice though quickly that some of these words don’t really mean a whole lot on their own – til, for, fra… – will be in any text no matter what it’s about. These are called “stopwords” and often, but again not always, we’ll want to get rid of them. Luckily corpus linguists have long been at work making stopword lists for many languages.</p>
<p>The R package <code>tm</code> inludes stopword lists for multiple languages.</p>
<pre class="r"><code>library(tm)
stopwords(&quot;no&quot;)</code></pre>
<pre><code>##   [1] &quot;og&quot;        &quot;i&quot;         &quot;jeg&quot;       &quot;det&quot;       &quot;at&quot;        &quot;en&quot;        &quot;et&quot;        &quot;den&quot;       &quot;til&quot;       &quot;er&quot;        &quot;som&quot;       &quot;på&quot;       
##  [13] &quot;de&quot;        &quot;med&quot;       &quot;han&quot;       &quot;av&quot;        &quot;ikke&quot;      &quot;ikkje&quot;     &quot;der&quot;       &quot;så&quot;        &quot;var&quot;       &quot;meg&quot;       &quot;seg&quot;       &quot;men&quot;      
##  [25] &quot;ett&quot;       &quot;har&quot;       &quot;om&quot;        &quot;vi&quot;        &quot;min&quot;       &quot;mitt&quot;      &quot;ha&quot;        &quot;hadde&quot;     &quot;hun&quot;       &quot;nå&quot;        &quot;over&quot;      &quot;da&quot;       
##  [37] &quot;ved&quot;       &quot;fra&quot;       &quot;du&quot;        &quot;ut&quot;        &quot;sin&quot;       &quot;dem&quot;       &quot;oss&quot;       &quot;opp&quot;       &quot;man&quot;       &quot;kan&quot;       &quot;hans&quot;      &quot;hvor&quot;     
##  [49] &quot;eller&quot;     &quot;hva&quot;       &quot;skal&quot;      &quot;selv&quot;      &quot;sjøl&quot;      &quot;her&quot;       &quot;alle&quot;      &quot;vil&quot;       &quot;bli&quot;       &quot;ble&quot;       &quot;blei&quot;      &quot;blitt&quot;    
##  [61] &quot;kunne&quot;     &quot;inn&quot;       &quot;når&quot;       &quot;være&quot;      &quot;kom&quot;       &quot;noen&quot;      &quot;noe&quot;       &quot;ville&quot;     &quot;dere&quot;      &quot;som&quot;       &quot;deres&quot;     &quot;kun&quot;      
##  [73] &quot;ja&quot;        &quot;etter&quot;     &quot;ned&quot;       &quot;skulle&quot;    &quot;denne&quot;     &quot;for&quot;       &quot;deg&quot;       &quot;si&quot;        &quot;sine&quot;      &quot;sitt&quot;      &quot;mot&quot;       &quot;å&quot;        
##  [85] &quot;meget&quot;     &quot;hvorfor&quot;   &quot;dette&quot;     &quot;disse&quot;     &quot;uten&quot;      &quot;hvordan&quot;   &quot;ingen&quot;     &quot;din&quot;       &quot;ditt&quot;      &quot;blir&quot;      &quot;samme&quot;     &quot;hvilken&quot;  
##  [97] &quot;hvilke&quot;    &quot;sånn&quot;      &quot;inni&quot;      &quot;mellom&quot;    &quot;vår&quot;       &quot;hver&quot;      &quot;hvem&quot;      &quot;vors&quot;      &quot;hvis&quot;      &quot;både&quot;      &quot;bare&quot;      &quot;enn&quot;      
## [109] &quot;fordi&quot;     &quot;før&quot;       &quot;mange&quot;     &quot;også&quot;      &quot;slik&quot;      &quot;vært&quot;      &quot;være&quot;      &quot;båe&quot;       &quot;begge&quot;     &quot;siden&quot;     &quot;dykk&quot;      &quot;dykkar&quot;   
## [121] &quot;dei&quot;       &quot;deira&quot;     &quot;deires&quot;    &quot;deim&quot;      &quot;di&quot;        &quot;då&quot;        &quot;eg&quot;        &quot;ein&quot;       &quot;eit&quot;       &quot;eitt&quot;      &quot;elles&quot;     &quot;honom&quot;    
## [133] &quot;hjå&quot;       &quot;ho&quot;        &quot;hoe&quot;       &quot;henne&quot;     &quot;hennar&quot;    &quot;hennes&quot;    &quot;hoss&quot;      &quot;hossen&quot;    &quot;ikkje&quot;     &quot;ingi&quot;      &quot;inkje&quot;     &quot;korleis&quot;  
## [145] &quot;korso&quot;     &quot;kva&quot;       &quot;kvar&quot;      &quot;kvarhelst&quot; &quot;kven&quot;      &quot;kvi&quot;       &quot;kvifor&quot;    &quot;me&quot;        &quot;medan&quot;     &quot;mi&quot;        &quot;mine&quot;      &quot;mykje&quot;    
## [157] &quot;no&quot;        &quot;nokon&quot;     &quot;noka&quot;      &quot;nokor&quot;     &quot;noko&quot;      &quot;nokre&quot;     &quot;si&quot;        &quot;sia&quot;       &quot;sidan&quot;     &quot;so&quot;        &quot;somt&quot;      &quot;somme&quot;    
## [169] &quot;um&quot;        &quot;upp&quot;       &quot;vere&quot;      &quot;vore&quot;      &quot;verte&quot;     &quot;vort&quot;      &quot;varte&quot;     &quot;vart&quot;</code></pre>
<p>So what we want to do is take our <code>nrk</code> tibble and for every word, ie every row of the dataframe, check if it’s in <code>stopwords("no")</code> and if it is remove it. This is accomplished with what is called an “anti-join”, doing exactly what the previous sentence said. First, we turn the list (actually a character vector) of stopwords into a tibble with the column of the same name as our column of words in <code>nrk</code> (here called tokens) so we don’t have to specify it in our anti-join.</p>
<pre class="r"><code>stop_no &lt;- tibble(token = stopwords(&quot;no&quot;))
nrk %&gt;%
  unnest_tokens(token, text) %&gt;%
  anti_join(stop_no) %&gt;%
  count(token, sort = TRUE)</code></pre>
<pre><code>## Joining, by = &quot;token&quot;</code></pre>
<pre><code>## # A tibble: 88 x 2
##    token              n
##    &lt;chr&gt;          &lt;int&gt;
##  1 prosent            8
##  2 regjeringen        5
##  3 aksjer             4
##  4 øke                4
##  5 formuesskatten     3
##  6 neste              3
##  7 år                 3
##  8 2021               2
##  9 35                 2
## 10 45                 2
## # ... with 78 more rows</code></pre>
<p>This looks perhaps more informative.</p>
<p>The other thing we might want to do is make words such as “endring”, “endringer”, “endringene” into one word. This process is called “stemming” and is a somewhat more advanced process than just getting rid of stopwords. To do this we use a package in R called <code>SnowballC</code>.</p>
<pre class="r"><code>library(SnowballC)
words_to_stem &lt;- c(&quot;endring&quot;, &quot;endringer&quot;, &quot;endringene&quot;)
SnowballC::wordStem(words_to_stem, language = &quot;no&quot;)</code></pre>
<pre><code>## [1] &quot;endring&quot; &quot;endring&quot; &quot;endring&quot;</code></pre>
<p>To apply this to our “corpus” of 4 paragraphs of the nrk text, we use the mutate function that creates a new column of our dataframe, the stemmed word. Then we apply our <code>count()</code> function to get a top frequency list.</p>
<pre class="r"><code>(nrk_stemmed &lt;- nrk %&gt;%
  unnest_tokens(token, text) %&gt;%
  anti_join(stop_no) %&gt;%
  mutate(stemmed_token = wordStem(token, &quot;no&quot;)) %&gt;%
  count(stemmed_token, sort = TRUE)
)</code></pre>
<pre><code>## Joining, by = &quot;token&quot;</code></pre>
<pre><code>## # A tibble: 85 x 2
##    stemmed_token     n
##    &lt;chr&gt;         &lt;int&gt;
##  1 prosent           8
##  2 aksj              6
##  3 regjering         6
##  4 verdi             4
##  5 øke               4
##  6 formuesskatt      3
##  7 nest              3
##  8 år                3
##  9 2021              2
## 10 35                2
## # ... with 75 more rows</code></pre>
<p>Finally, with the top frequency list as a dataframe, we can then graph it using ggplot2, an extremely powerful part of the tidyverse.</p>
<pre class="r"><code>nrk_stemmed %&gt;%
  top_n(10) %&gt;%                     # selecting to show only top 15 words
  mutate(words = reorder(stemmed_token,n)) %&gt;%  # this will ensure that the highest frequency words appear to the left
  ggplot(aes(words, n)) +
    geom_col() +
    coord_flip()</code></pre>
<pre><code>## Selecting by n</code></pre>
<p><img src="session2_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
</div>
<div id="wordclouds" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> Wordclouds</h1>
<p>There are several packages that will take a dataframe of frequency counts and turn them into word clouds.</p>
<pre class="r"><code>library(wordcloud)
library(wordcloud2)
nrk_stemmed %&gt;%
  with(wordcloud(stemmed_token, n, max.words = 50))</code></pre>
<p><img src="session2_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>The `wordcloud2`` will make a little prettier, more advanced wordcloud. It wants a dataframe with one column called word and one called freq so we do this and then pass the dataframe to the function.</p>
<pre class="r"><code>data &lt;- nrk_stemmed %&gt;%
  rename(word = stemmed_token) %&gt;%
  rename(freq = n) %&gt;%
  top_n(100)</code></pre>
<pre><code>## Selecting by freq</code></pre>
<pre class="r"><code>wordcloud2(data, size = 2)</code></pre>
<div id="htmlwidget-9b2a146f4e6413b3acc5" style="width:672px;height:480px;" class="wordcloud2 html-widget"></div>
<script type="application/json" data-for="htmlwidget-9b2a146f4e6413b3acc5">{"x":{"word":["prosent","aksj","regjering","verdi","øke","formuesskatt","nest","år","2021","35","45","avgift","betyr","co2","driftsmidl","endring","faktisk","foreslår","formuesrabatt","kron","kutt","nærmer","sett","skattemess","solberg","øker","0,85","0,95","1,5","1,65","12","25","28","3,66","41","bensin","bety","betydning","budsjett","bunnfradrag","dag","dobbelt","drivstoffpris","ekstr","ektep","fall","finansminist","formu","forslag","forvent","fram","fritidsbo","får","gi","gjør","grep","hatt","kl","klim","legg","likningsverdi","lit","milliard","million","mindr","netto","per","prisstigning","rund","samtid","sat","slagsvold","sp","statsbudsjett","statskass","stor","totalt","tre","trygv","uker","utgå","utov","vedum","økes","øre"],"freq":[8,6,6,4,4,3,3,3,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],"fontFamily":"Segoe UI","fontWeight":"bold","color":"random-dark","minSize":0,"weightFactor":45,"backgroundColor":"white","gridSize":0,"minRotation":-0.785398163397448,"maxRotation":0.785398163397448,"shuffle":true,"rotateRatio":0.4,"shape":"circle","ellipticity":0.65,"figBase64":null,"hover":null},"evals":[],"jsHooks":{"render":[{"code":"function(el,x){\n                        console.log(123);\n                        if(!iii){\n                          window.location.reload();\n                          iii = False;\n\n                        }\n  }","data":null}]}}</script>
</div>
<div id="larger-corpora" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> Larger corpora</h1>
<p>We now have basic tools that we can apply to larger corpora. The details of reading in texts and corpora would take much longer than the time we have today but R has a number of packages that allow us to access texts that have already been digitized and cleaned. One example is the <code>gutenbergr</code> which allows you to access texts in the Project Gutenberg library (<a href="https://www.gutenberg.org/" class="uri">https://www.gutenberg.org/</a>). If you go to the site and search books, you’ll see that everyone has an ID number that we can then use to get the texts in R. We’ll use the English translation of Pan, by Knut Hamsun, as our example. We’ll do the same as above, with the slight difference of language for stemming and stopwording.</p>
<pre class="r"><code>library(gutenbergr)
pan &lt;- gutenberg_download(7214, strip = TRUE)
pan</code></pre>
<pre><code>## # A tibble: 5,254 x 2
##    gutenberg_id text                                                           
##           &lt;int&gt; &lt;chr&gt;                                                          
##  1         7214 &quot;PAN&quot;                                                          
##  2         7214 &quot;&quot;                                                             
##  3         7214 &quot;By Knut Hamsun&quot;                                               
##  4         7214 &quot;&quot;                                                             
##  5         7214 &quot;Translated from the Norwegian of Knut Hamsun By W. W. Worster&quot;
##  6         7214 &quot;&quot;                                                             
##  7         7214 &quot;With an Introduction by Edwin Bjoerkman&quot;                      
##  8         7214 &quot;&quot;                                                             
##  9         7214 &quot;New York&quot;                                                     
## 10         7214 &quot;&quot;                                                             
## # ... with 5,244 more rows</code></pre>
<p>This is the whole novel together with a number of headers, translator’s introduction, and so on. We can view the whole thing in R in a separate window with <code>View(pan)</code>. When we do this we see that the novel itself begins on line 242 so we’ll cut it down to this and then look at word frequencies.</p>
<pre class="r"><code>pan %&gt;%
  unnest_tokens(token, text) %&gt;%
  count(token, sort = TRUE)</code></pre>
<pre><code>## # A tibble: 4,158 x 2
##    token     n
##    &lt;chr&gt; &lt;int&gt;
##  1 the    1965
##  2 i      1927
##  3 and    1662
##  4 to     1009
##  5 a       983
##  6 of      797
##  7 was     689
##  8 it      683
##  9 in      639
## 10 you     625
## # ... with 4,148 more rows</code></pre>
<p>We’ll definitely want to remove stopwords. We’ll use the stop_words dataframe of English stopwords in `tidytext<code>, thought we could also do this from the</code>tm<code>package in the same way as above (ie.</code>tibble(token = stopwords(“en”))``). We’ll stem at the same time.</p>
<pre class="r"><code>pan_words &lt;- pan %&gt;%
  unnest_tokens(token, text) %&gt;%
  anti_join(stop_words, by = c(&quot;token&quot; = &quot;word&quot;)) %&gt;%
  mutate(stemmed_token = wordStem(token, &quot;en&quot;)) %&gt;%
  count(stemmed_token, sort = TRUE)
pan_words</code></pre>
<pre><code>## # A tibble: 2,680 x 2
##    stemmed_token     n
##    &lt;chr&gt;         &lt;int&gt;
##  1 day             153
##  2 edwarda         140
##  3 time            140
##  4 answer          107
##  5 look             93
##  6 eye              91
##  7 hand             86
##  8 glahn            85
##  9 hut              84
## 10 night            81
## # ... with 2,670 more rows</code></pre>
<p>Now we can easily make graphs and word clouds.</p>
<pre class="r"><code>pan_words %&gt;%
  top_n(25) %&gt;%                     # selecting to show only top 15 words
  mutate(words = reorder(stemmed_token,n)) %&gt;%  # this will ensure that the highest frequency words appear to the left
  ggplot(aes(words, n)) +
    geom_col() +
    coord_flip()</code></pre>
<pre><code>## Selecting by n</code></pre>
<p><img src="session2_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<pre class="r"><code>pan_words %&gt;%
  with(wordcloud(stemmed_token, n, max.words = 50))</code></pre>
<p><img src="session2_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<pre class="r"><code>data1 &lt;- pan_words %&gt;%
  rename(word = stemmed_token) %&gt;%
  rename(freq = n) %&gt;%
  top_n(180)</code></pre>
<pre><code>## Selecting by freq</code></pre>
<pre class="r"><code>wordcloud2(data1, size = 1)</code></pre>
<div id="htmlwidget-51a4280876788ca5b830" style="width:672px;height:480px;" class="wordcloud2 html-widget"></div>
<script type="application/json" data-for="htmlwidget-51a4280876788ca5b830">{"x":{"word":["day","edwarda","time","answer","look","eye","hand","glahn","hut","night","doctor","eva","wood","talk","mack","aesop","walk","pass","stood","herr","love","home","call","even","shot","sit","heard","head","round","hear","sea","sat","stand","hour","laugh","wait","gun","boat","feel","heart","lay","life","smile","girl","met","think","stop","sudden","arm","bird","door","window","close","ladi","step","happen","hill","rememb","shoot","cri","fire","leav","lie","moment","move","speak","word","sun","god","strang","white","joy","baron","hamsun","maggi","morn","road","care","cold","left","live","told","tree","understand","watch","danc","glass","listen","voic","fish","ground","heaven","hous","set","happi","mind","mine","air","notic","peopl","rain","sound","stay","woman","wrong","child","come","friend","grass","light","meet","soul","wind","earth","feather","half","minut","morrow","neck","shoe","spoke","dead","drink","foot","kiss","parti","quay","quick","quiet","red","stone","summer","wet","dog","found","hope","lieuten","o'clock","reach","sake","silent","sleep","stare","start","stick","surpris","till","whisper","book","dress","father","hair","hold","offer","row","run","short","trembl","water","bit","breath","chang","chew","dark","dri","flower","forest","front","glanc","green","human","hurri","iselin","load","rock","rose","shoulder","sky","touch","week"],"freq":[153,140,140,107,93,91,86,85,84,81,78,72,69,65,63,61,61,60,60,57,57,55,54,54,54,54,53,52,48,47,47,46,46,45,45,42,41,39,39,38,38,37,37,36,36,36,35,35,34,34,34,34,33,33,33,32,32,32,32,31,31,31,31,31,31,31,31,30,29,29,29,28,26,26,26,26,26,25,25,25,25,25,25,25,25,24,24,24,24,23,23,23,23,23,22,22,22,21,21,21,21,21,21,21,21,20,20,20,20,20,20,20,20,19,19,19,19,19,19,19,19,18,18,18,18,18,18,18,18,18,18,18,18,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,16,16,16,16,16,16,16,16,16,16,16,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15],"fontFamily":"Segoe UI","fontWeight":"bold","color":"random-dark","minSize":0,"weightFactor":1.17647058823529,"backgroundColor":"white","gridSize":0,"minRotation":-0.785398163397448,"maxRotation":0.785398163397448,"shuffle":true,"rotateRatio":0.4,"shape":"circle","ellipticity":0.65,"figBase64":null,"hover":null},"evals":[],"jsHooks":{"render":[{"code":"function(el,x){\n                        console.log(123);\n                        if(!iii){\n                          window.location.reload();\n                          iii = False;\n\n                        }\n  }","data":null}]}}</script>
</div>

<br><br><p>2021. <a href="mailto: gregory.fergusoncradler@inn.no">gregory.fergusoncradler@inn.no</a></p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
